# Geo Walker

# エレベーターピッチ

知らない街を冒険したいけど、計画が面倒？このアプリなら、ボタンひとつでランダムな目的地を生成し、ルートと予定表を自動生成します。個人旅行者にわくわくする旅と新しい発見を届ける。

---

# 競合アプリとの差別化ポイント

| 項目 | 内容 |
| --- | --- |
| **1. ランダム目的地提案機能** | Google Mapsなど従来のナビアプリはユーザー主導の目的地設定が基本だが、本アプリは「未知との遭遇」を重視し、ランダム提案が中心。 |
| **2. 徒歩ルートに特化** | 観光・冒険向けに徒歩と自転車向け。細かい地形を考慮し、安全性にも配慮。 |
| **3. UI/UX演出で冒険心を刺激** | 目的地決定時に地図が「ズームイン」していく演出など、遊び心のある演出でワクワク感を演出。 |
| **4. 低コスト・個人向け設計** | lieflet.js、無料のAPI、postgisなどなるべく費用がかからない外部サービスを利用しコストカット |

---

## 利用が想定される外部APIと利用目的

| API名 / 技術 | 利用目的 | 無料プランの有無 / 備考 |
| --- | --- | --- |
| **OpenCelliD API** | 基地局位置データから電波状況の判定（圏外回避） | 無料（APIキー必要） |
| **Open-Elevation API**（または Mapbox Terrain-RGB） | 標高データ取得。坂道・山道を避けるルートの安全性評価 | あり（無料オプション多数） |
| **Leaflet.js + 地図タイルAPI（Mapbox / OSMなど）** | 軽量な地図描画。ズーム演出やオフライン利用にも適す | 無料・Mapboxは上限あり |
| **Nominatim（OSMジオコーディング）** | 緯度経度 ⇄ 住所変換の無料代替（Google API節約） | 無料（アクセス制限あり） |
| **OpenWeatherMap API**（オプション） | ルート付近の天気情報提供 | あり（無料プラン） |
| **PWA（Service Worker / Web Manifest）** | アプリのオフライン動作・スマホインストール対応 | ブラウザ標準対応 |
| **Postgis** | 水域、軍の土地、崖などに生成されないように地理情報を取得 | 無料 |

## 追加機能（将来的な差別化拡張）

| 機能 | 利用API候補 |
| --- | --- |
| **体力消費シミュレーション**（高低差・距離から） | OpenElevation + Google Fit連携 |
| **冒険ログ保存・共有** | SNS連携（Twitter API, Instagram APIなど） |
| **AIによる冒険テーマの提案** | ChatGPT API or OpenAI Function Calling |

# 課題

- 必要な言語の学習（Udemy一周してあとは実践）
- postgisの勉強
- 外部APIを使うためのアカウントの作成
- APIの呼び出し順をどうするか
- トランザクション管理をどうするか
- MVP（まずは現在地から〜km範囲のランダムなピンを指す機能から作る。）
- インフラ構成図の作成
- 使用技術の調査

# 機能要件

| No. | カテゴリ | 要件内容 |  |
| --- | --- | --- | --- |
| F1 | ランダム目的地生成 | 現在地または指定地点から一定範囲内の地点をランダムに選出する（安全性や電波状況、都市部に近いなどの条件付き） |  |
| F2 | 目的地の情報表示 | 選ばれた目的地の名称、簡単な説明、写真（可能であれば）、現在地からの距離などを表示 |  |
| F3 | 徒歩ルート生成 | Directions APIまたはOSMベースで徒歩ルートを自動生成し、所要時間と距離を表示 |  |
| F4 | 高低差・坂道考慮 | OpenElevationなどから標高情報を取得し、坂道や急傾斜の回避ルートを選定 |  |
| F5 | 電波状況チェック | OpenCelliDの基地局情報を元に、圏外リスクを警告表示 |  |
| F6 | 緊急情報の登録と表示 | 緊急連絡先、退出ルート、最寄りの避難ポイントなどを事前登録・閲覧可能にする |  |
| F7 | ルートスケジュール作成 | 移動予定時間・到着時間・滞在時間をスケジュール形式で表示 |  |
| F8 | オフライン対応 | IndexedDBにより、地図、ルート、スケジュール、緊急情報を保存・参照可能にする |  |
| F9 | 地図表示とズーム演出 | Leaflet.js等で地図を表示し、目的地決定時にズームイン演出を行う |  |
| F10 | 冒険ログ保存 | 目的地・訪問履歴・撮影写真を保存（Supabase等でクラウド保存） |  |
| F11 | ユーザー認証 | メールまたはOAuthでログインし、ユーザー個別の冒険データを管理 |  |
| F12 | PWA対応 | モバイル端末にアプリとしてインストール可能なPWA仕様に対応 |  |
| F13 | 友達との中間地点を出発地にする機能 | 最寄駅が友達同士で違うので、中間ポイントを取ってそこを待ち合わせにする。 |  |
| F14 | 地点ごとの写真データを取ってそこを共有する機能 |  |  |
| F15 | ルート編集機能 | 突発的に中間ルートを編集できる |  |

---

# 非機能要件

| No. | カテゴリ | 要件内容 |
| --- | --- | --- |
| N1 | パフォーマンス | 目的地提案からルート表示まで、5秒以内に完了すること |
| N2 | 可用性 | サービス稼働率99%以上（Supabaseなどのクラウドサービスを活用） |
| N3 | セキュリティ | ユーザーデータはSupabase Authで認証し、StorageとDBに適切な権限管理を行う |
| N4 | 拡張性 | 新たな目的地カテゴリや電波データプロバイダーの追加に対応できる構成であること |
| N5 | 保守性 | APIキー・設定値を環境変数で一元管理し、デプロイ・更新が容易であること |
| N6 | オフライン耐性 | すべてのコア機能（地図閲覧・ルート確認・緊急連絡先確認）がオフライン状態でも機能すること |
| N7 | モバイル最適化 | スマートフォンでの表示・操作性を優先設計とする（レスポンシブ対応） |
| N8 | データ通信最適化 | オフライン用の地図やルートデータは必要最小限のみ事前取得し、通信量を節約する |
| N9 | 多言語対応（できれば） | 国外ユーザー向けに、英語・日本語の2言語に対応（初期は日本語のみでも可） |
| N10 | ライセンス準拠 | 使用する地図・API（OpenStreetMap, OpenCelliD等）の利用規約を遵守すること |

# 各テーブルの詳細設計

### 1. `users`（ユーザー）

| カラム名 | 型 | 補足 |
| --- | --- | --- |
| `id` | UUID | 主キー（Auth連携） |
| `email` | STRING | メールアドレス |
| `password_hash` | STRING | ローカル認証用 |
| `provider` | STRING | Google, Apple など |
| `created_at` | TIMESTAMP | 登録日時 |

---

### 2. `adventures`（1回の冒険）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | 冒険ID |
| `user_id` | UUID | 外部キー |
| `start_time` | TIMESTAMP | 開始時刻 |
| `end_time` | TIMESTAMP | 終了時刻（nullable） |
| `status` | STRING | `planned`, `in_progress`, `completed`, `failed` 
将来的な拡張（再開機能・履歴管理・分析など）を見越す |
| `failure_reason` | STRING | `NOT_ENOUGH_CANDIDATES` などの識別子（nullable） |
| `total_distance` | FLOAT | 予定されていた距離（例：5.0） |
| `created_at` | TIMESTAMP | 作成日時 |

---

### 3. `adventure_preferences`（ユーザーが指定した条件）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | 主キー |
| `adventure_id` | UUID | 外部キー |
| `ordered_spot_types` | TEXT[][] | 例：`[['park', 'scenic'], ['shrine', 'temple']]`（順序ありの候補） |
| `total_distance_km` | FLOAT | ユーザーが指定した全体距離 |
| `created_at` | TIMESTAMP | 作成日時 |

---

### 4. `locations`（各スポット）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | 主キー |
| `local_name` | TEXT | 名称（APIで取得） |
| `latitude`  | FLOAT | 緯度 |
| `longitude` | FLOAT | 経度 |
| `type` | TEXT | `park`, `scenic_spot`, `shrine`, etc. |
| `is_accessible` | BOOLEAN | 立ち入り可能か |
| `is_watar_area` | BOOLEAN | 水域か |

---

### 5. `adventure_locations`（実際に選ばれた地点と順序）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | 主キー |
| `adventure_id` | UUID | 外部キー |
| `location_id` | UUID | 外部キー |
| `sequence` | INTEGER | 何番目の地点か（0=出発地, 1=スポット1, ...） |
| `type_used` | TEXT | 候補群の中から選ばれた type |
| `selection_type` | TEXT | `user_selected`, `random_fallback`, `auto_substituted` など
 |

---

### 6. `routes`（ルートGeoJSON）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | ルートID |
| `adventure_id` | UUID | 外部キー |
| `route_json` | JSONB | GeoJSONまたはPolyline |
| `total_distance` | FLOAT | 実距離（m） |
| `total_duration` | INTEGER | 時間（分） |

---

### 7. `lisk_zone`（危険地域判別用）

| カラム名 | 型 | 説明 |
| --- | --- | --- |
| `id` | UUID | 主キー |
| `code` | UUID | 外部キー |
| `name` | STRING |  |
| `geometory` | FLOAT | postgis |
| `created_at` | DAYTIME |  |

---

# ER図

![ER図](./readme-image/ER図v9drawio.svg)

# 画面遷移図

# MVP

### MVP第一段階：機能概要

**目的**：現在地から指定距離の範囲でランダムな目的地とユーザー指定のスポットをルートと予定表を自動生成する。

### 主なステップ

1. **出発地点の固定（大阪駅）**
    - 緯度経度：`34.702485, 135.495951`
2. **ランダム目的地の生成**
    - 大阪府のジオフェンス内でランダムにポイントを選出（地図API or 独自範囲）
    - 例：大阪府のGeoJSONを用いてランダムな座標を生成
3. **ルートの生成**
    - 出発地点〜目的地までの徒歩ルート（OpenRouteService, Google Directions APIなどを活用）
    - ステップ構成（例：チェックポイント数地点ごとに分割）
4. **予定表の作成**
    - 1kmあたり15分〜20分などのペースを仮定し、チェックポイント単位で時刻を算出
    - 出発時刻を固定（例：9:00）とし、経過時間を計算して各ポイントの予定時刻にする
5. **ルート画面＋スケジュール表示**
    - 地図上にピンとルートを描画
    - サイドや下部に簡易予定表（時刻＋チェックポイント名や位置）
6. **ローディング演出（生成中）**
    - 出発地点・距離・スタイルを決定後、「旅を生成中」の演出（約5秒）

 7.　**チェックポイントの作成、編集、削除機能**

- マップ画面から地点をタップすると予定表にチェックポイント

---

### 最低限必要な機能・技術要素（MVP用）

| 要素 | 技術例 |
| --- | --- |
| 地図表示 | Leaflet.js or Mapbox GL JS |
| ランダム地点生成 | Turf.js + 大阪府のGeoJSON |
| 徒歩ルート生成 | OpenRouteService API |
| フロント | Next.js + Tailwind CSS |
| 状態管理 | useState + useEffect（または Zustand） |
| スケジュール演算 | dayjs / date-fns などで時間計算 |

# インフラ構成図
